<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <title>店铺装修</title>
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/general.css" />
    <link href="js/spectrum-master/spectrum.css" rel="stylesheet">
    <link href="css/layoutit.css" rel="stylesheet">
    <link href="css/layer.css" rel="stylesheet" />
    <link href="css/dsc_visual.css" rel="stylesheet">

    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/scripts.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/layer.js"></script>
    <script type="text/javascript" src="js/jquery.SuperSlide.2.1.1.js"></script>
    <script type="text/javascript" src="js/spectrum-master/spectrum.js"></script>
    {insert_scripts files="../js/jquery.json.js,../js/transport_jquery.js,common.js"}
    <!--[if lt IE 9]>
	<script src="js/css3-mediaqueries.js"></script>
	<![endif]-->
    <!--[if lte IE 8]>
        <script type="Text/Javascript" language="JavaScript">
            $(function(){
                pb({
                    id:'notIe',
                    content:'<div class="noContent"><div class="noText"><p class="p1">您当前浏览器版本过低</p><p class="p1">不支持浏览</p><p class="p2">建议使用</p><p class="p3">谷歌、火狐、360极速、IE9以上版本</p></div></div>',
                    drag:false,
                    head:false,
                    cl_cBtn:false,
                    width:316,
                    height:376,
                    ok_title:"确定",
                    onOk:function(){
                        location.href = "../index.php";
                    }
                });
                
                $("#pb-mask").css('cssText','position: fixed; width: 100%; height: 100%; top: 0px; left: 0px; opacity: 1; overflow: hidden; z-index: 2000; background-color:#fff;')
            });
        </script>
    <![endif]-->
    <script type="text/javascript">
    //这里把JS用到的所有语言都赋值到这里
    {foreach from=$lang.js_languages key=key item=item}
    var {$key} = "{$item}";
    {/foreach}
    </script>
</head>

<body>
    <div class="main-wrapper">
        <div class="dp_leftcolumn">
            <ul class="tab-bar">
                <li class="modules">
                    <div class="wrap">
                        <div class="left-line"></div>
                        <i class="item-icon">&#xe60e;</i>
                        <span>模板</span>
                        <b class="b-small">&#xe606;</b>
                    </div>
                </li>
                <li class="page-head">
                    <div class="wrap">
                        <div class="left-line"></div>
                        <i class="item-icon">&#xe610;</i>
                        <span>头部</span>
                        <b class="b-small">&#xe606;</b>
                    </div>
                </li>
                <li class="page-content">
                    <div class="wrap">
                        <div class="left-line"></div>
                        <i class="item-icon">&#xe611;</i>
                        <span>中间</span>
                        <b class="b-small">&#xe606;</b>
                    </div>
                </li>
            </ul>
            <ul class="toolbar">
                <li class="li modules-slide">
                    <b class="close-icon">&#xe605;</b>
                    <div class="inside">
                        <p class="red">选择所需模块，并拖动至相应位置</p>                        
                    </div>
                    <div class="modules-box">
                        <div class="modules-wrap modules-wrap-current">
                            <div class="head"><span>基础模块</span></div>
                            <div class="module-list clearfix">
                                <div class="item lyrow lunbotu" data-mode="lunbo" data-purebox="adv" data-li="1" data-length="5">
                                    <div class="drag" data-html="not">
                                        <div class="navLeft">
                                            <span class="pic"><img src="images/visual/navLeft_01.png" /></span>
                                            <span class="txt">图片轮播</span>
                                        </div>
                                        <div class="setup_box">
                                            <div class="barbg"></div>
                                            <a href="javascript:void(0);" class="move-up icon-arrow-up"></a>
                                            <a href="javascript:void(0);" class="move-down icon-arrow-down"></a>
                                            <a href="javascript:void(0);" class="move-edit" ectype='model_edit'><i class="icon icon-edit"></i>编辑</a>
                                            <a href="javascript:void(0);" class="move-remove"><i class="icon icon-remove"></i>删除</a>
                                        </div>
                                    </div>
                                    <div class="view">
                                        <div class="shop_banner">
                                            <div class="hd"><ul></ul></div>
                                            <div class="bd">
                                                <ul data-type="range">
                                                    <li><a href="#"><img src="images/default/shop_banner_pic.jpg"></a></li>
                                                </ul>
                                            </div>
                                            <a href="javascript:;" class="prev" style="display:none;"></a>
                                            <a href="javascript:;" class="next" style="display:none;"></a>
                                        </div>
                                    </div>
                                </div>
                                <div class="item lyrow w1200" data-mode="advImg1" data-purebox="adv" data-li="1" data-length="5" data-json="{}">
                                    <div class="drag" data-html="not">
                                        <div class="navLeft">
                                            <span class="pic"><img src="images/visual/navLeft_02.png" /></span>
                                            <span class="txt">广告区一</span>
                                        </div>
                                        <div class="setup_box">
                                            <div class="barbg"></div>
                                            <a href="javascript:void(0);" class="move-up icon-arrow-up"></a>
                                            <a href="javascript:void(0);" class="move-down icon-arrow-down"></a>
                                            <a href="javascript:void(0);" class="move-edit" ectype='model_edit'><i class="icon icon-edit"></i>编辑</a>
                                            <a href="javascript:void(0);" class="move-remove"><i class="icon icon-remove"></i>删除</a>
                                        </div>
                                    </div>
                                    <div class="view">
                                        <div class="adv_module">
                                            <div class="hd"><ul></ul></div>
                                            <div class="bd">
                                                <ul data-type="range">
                                                    <li><a href=""><img src="images/default/ad_01_pic.jpg"></a></li>
                                                </ul>
                                            </div> 
                                        </div>
                                    </div>
                                </div>

                                <div class="item lyrow w1200" data-mode="advImg2" data-purebox="adv" data-length="2" data-li="1">
                                    <div class="drag" data-html="not">
                                        <div class="navLeft">
                                            <span class="pic"><img src="images/visual/2.png" width="1200" /></span>
                                            <span class="txt">广告区二</span>
                                        </div>
                                        <div class="setup_box">
                                            <div class="barbg"></div>
                                            <a href="javascript:void(0);" class="move-up icon-arrow-up"></a>
                                            <a href="javascript:void(0);" class="move-down icon-arrow-down"></a>
                                            <a href="javascript:void(0);" class="move-edit" ectype='model_edit'><i class="icon icon-edit"></i>编辑</a>
                                            <a href="javascript:void(0);" class="move-remove"><i class="icon icon-remove"></i>删除</a>
                                        </div>
                                    </div>
                                    <div class="view">
                                        <div class="advertising">
                                            <ul data-type="range">
                                                <li><a href="#"><img src="images/default/ad_02_a_pic.jpg" width="595" height="595"></a></li>
                                                <li><a href="#"><img src="images/default/ad_02_a_pic.jpg" width="595" height="595"></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="item lyrow w1200" data-mode="advImg3" data-li="1" data-length="2" data-purebox="adv">
                                    <div class="drag" data-html="not">
                                        <div class="navLeft">
                                            <span class="pic"><img src="images/visual/3.png" /></span>
                                            <span class="txt">广告区三</span>
                                        </div>
                                        <div class="setup_box">
                                            <div class="barbg"></div>
                                            <a href="javascript:void(0);" class="move-up icon-arrow-up"></a>
                                            <a href="javascript:void(0);" class="move-down icon-arrow-down"></a>
                                            <a href="javascript:void(0);" class="move-edit" ectype='model_edit'><i class="icon icon-edit"></i>编辑</a>
                                            <a href="javascript:void(0);" class="move-remove"><i class="icon icon-remove"></i>删除</a>
                                        </div>
                                    </div>
                                    <div class="view">
                                        <div class="advertising">
                                            <ul data-type="range">
                                                <li><a href="#"><img src="images/default/ad_02_c_pic.jpg"></a></li>
                                                <li><a href="#"><img src="images/default/ad_02_d_pic.jpg"></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="item lyrow w1200" data-mode="advImg4" data-purebox="adv" data-li="1">
                                    <div class="drag" data-html="not">
                                        <div class="navLeft">
                                            <span class="pic"><img src="images/visual/4.png" /></span>
                                            <span class="txt">广告区四</span>
                                        </div>
                                        <div class="setup_box">
                                            <div class="barbg"></div>
                                            <a href="javascript:void(0);" class="move-up icon-arrow-up"></a>
                                            <a href="javascript:void(0);" class="move-down icon-arrow-down"></a>
                                            <a href="javascript:void(0);" class="move-edit" ectype='model_edit'><i class="icon icon-edit"></i>编辑</a>
                                            <a href="javascript:void(0);" class="move-remove"><i class="icon icon-remove"></i>删除</a>
                                        </div>
                                    </div>
                                    <div class="view">
                                        <div class="advertising">
                                            <ul class="row6" data-type="range">
                                                <li><a href="#"><span class="btm"></span><img src="images/default/ad_03_pic.jpg"></a></li>
                                                <li><a href="#"><span class="btm"></span><img src="images/default/ad_03_pic.jpg"></a></li>
                                                <li><a href="#"><span class="btm"></span><img src="images/default/ad_03_pic.jpg"></a></li>
                                                <li><a href="#"><span class="btm"></span><img src="images/default/ad_03_pic.jpg"></a></li>
                                                <li><a href="#"><span class="btm"></span><img src="images/default/ad_03_pic.jpg"></a></li>
                                                <li><a href="#"><span class="btm"></span><img src="images/default/ad_03_pic.jpg"></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="item lyrow w1200" data-mode="floor" data-purebox="goods">
                                    <div class="drag" data-html="not">
                                        <div class="navLeft">
                                            <span class="pic"><img src="images/visual/navLeft_03.png" /></span>
                                            <span class="txt">商品楼层</span>
                                        </div>
                                        <div class="setup_box">
                                            <div class="barbg"></div>
                                            <a href="javascript:void(0);" class="move-up icon-arrow-up"></a>
                                            <a href="javascript:void(0);" class="move-down icon-arrow-down"></a>
                                            <a href="javascript:void(0);" class="move-edit" ectype='model_edit'><i class="icon icon-edit"></i>编辑</a>
                                            <a href="javascript:void(0);" class="move-remove"><i class="icon icon-remove"></i>删除</a>
                                        </div>
                                    </div>
                                    <div class="view">
                                        <div class="floor" data-type="range">
                                            <div class="mt">
                                                <div class="con">
                                                    <h2>商品楼层名称</h2>
                                                    <p>商品楼层简单介绍文字</p>
                                                </div>
                                            </div>
                                            <div class="mc w1200">
                                                <ul class="row4">
                                                    <li>
                                                        <div class="img"><a href="" title=""><img src="images/default/gd_pic_02.jpg"></a></div>
                                                        <div class="info">
                                                            <div class="name"><a href="">商品名称</a></div>
                                                            <div class="price">￥65.00</div>
                                                            <div class="btn_hover"><a href="">立即购买</a></div>
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="img"><a href="" title=""><img src="images/default/gd_pic_02.jpg"></a></div>
                                                        <div class="info">
                                                            <div class="name"><a href="">商品名称</a></div>
                                                            <div class="price">￥65.00</div>
                                                            <div class="btn_hover"><a href="">立即购买</a></div>
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="img"><a href="" title=""><img src="images/default/gd_pic_02.jpg"></a></div>
                                                        <div class="info">
                                                            <div class="name"><a href="">商品名称</a></div>
                                                            <div class="price">￥65.00</div>
                                                            <div class="btn_hover"><a href="">立即购买</a></div>
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="img"><a href="" title=""><img src="images/default/gd_pic_02.jpg"></a></div>
                                                        <div class="info">
                                                            <div class="name"><a href="">商品名称</a></div>
                                                            <div class="price">￥65.00</div>
                                                            <div class="btn_hover"><a href="">立即购买</a></div>
                                                        </div>
                                                    </li>
                                                </ul>
                                                <input name='goods_info' type='hidden' value=''/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="item lyrow" data-mode="custom" data-purebox="cust">
                                    <div class="drag" data-html="not">
                                        <div class="navLeft">
                                            <span class="pic"><img src="images/visual/navLeft_04.png" /></span>
                                            <span class="txt">自定义区</span>
                                        </div>
                                        <div class="setup_box">
                                            <div class="barbg"></div>
                                            <a href="javascript:void(0);" class="move-up icon-arrow-up"></a>
                                            <a href="javascript:void(0);" class="move-down icon-arrow-down"></a>
                                            <a href="javascript:void(0);" class="move-edit" ectype='model_edit'><i class="icon icon-edit"></i>编辑</a>
                                            <a href="javascript:void(0);" class="move-remove"><i class="icon icon-remove"></i>删除</a>
                                        </div>
                                    </div>
                                    <div class="view">
                                        <div class="custom" data-type="range"><div class="default ui-draggable ui-box-display">自定义内容，可以用来展示店铺的特色区域。</div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="li page-head-slide" data-style="head">
                    <b class="close-icon">&#xe605;</b>
                    <div class="page-head-bg-content">
                        <div class="page-head-bg-content-wrap">
                            <div class="page-head-bg">
                                <label class="tit">头部背景色：</label>
                                <input type="hidden" class="tm-picker-trigger" value="{$head.bg_color}"  />
                                <input type="checkbox" class="ui-checkbox" name="header_dis" value="0" id="header_dis" {if $head.if_show eq 1}checked{/if} /> 
                                <label for="header_dis" class="ui-label">显示</label>
                            </div>
                            <div class="page-head-bgimg clearfix">
                                <form  action="" id="bgfileForm" method="post"  enctype="multipart/form-data"  runat="server" >
                                    <div><label class="tit">头部背景图：</label></div>
                                    <div class="bgimg" ><input name="fileimg" type="hidden" value="{if $head.img_file}{$head.img_file}{else}images/bgimg.gif{/if}"/><img id="showbgfile" src="{if $head.img_file}{$head.img_file}{else}images/bgimg.gif{/if}" alt=""></div>
                                    <div class="action">
                                        <div class="action-btn">
                                            <a href="javascript:void(0);" class="ks-uploader-button">
                                                <span class="btn-text">更换图片</span>
                                                <div class="file-input-wrapper"><input type="file" name="hdfile" value="更换图片" class="file-input"></div>
                                            </a>
                                            <a href="javascript:void(0);" class="delete">删除</a>
                                        </div>
                                        <div class="content">
                                            <div>文件格式：GIF,JPG,PNG</div>
                                            <div>文件大小：200k以内</div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="bg-show clearfix" {if $head.img_file == ''}style="display:none;"{/if}>
                                <div>背景显示：</div>
                                <div class="bg-show-nr">
                                    <a href="javascript:void(0);" {if $head.bgrepeat eq 'repeat'}class="current"{/if} data-bg-show="repeat">平铺</a>
                                    <a href="javascript:void(0);" {if $head.bgrepeat eq 'repeat-y'}class="current"{/if} data-bg-show="repeat-y">纵向平铺</a>
                                    <a href="javascript:void(0);" {if $head.bgrepeat eq 'repeat-x'}class="current"{/if} data-bg-show="repeat-x">横向平铺</a>
                                    <a href="javascript:void(0);" {if $head.bgrepeat eq 'no-repeat'}class="current"{/if} data-bg-show="no-repeat">不平铺</a>
                                </div>
                            </div>
                            <div class="bg-align clearfix" {if $head.img_file == ''}style="display:none;"{/if}>
                                <div>背景对齐：</div>
                                <div class="bg-align-nr">
                                    <a href="javascript:void(0);" {if $head.align eq 'left'}class="current"{/if} data-bg-align="left">左对齐</a>
                                    <a href="javascript:void(0);" {if $head.align eq 'center'}class="current"{/if} data-bg-align="center">居中</a>
                                    <a href="javascript:void(0);" {if $head.align eq 'right'}class="current"{/if} data-bg-align="right">右对齐</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="li page-content-slide" data-style="content">
                    <b class="close-icon">&#xe605;</b>
                    <div class="page-head-bg-content">
                        <div class="page-head-bg-content-wrap">
                            <div class="page-head-bg">
                                <label class="tit">中间背景色：</label>
                                <input type="hidden" class="tm-picker-trigger" value="{$content.bg_color}" />
                                <input type="checkbox" class="ui-checkbox" name="content_dis" value="0" id="content_dis" {if $content.if_show eq 1}checked{/if}/> 
                                <label for="content_dis" class="ui-label">显示</label>
                            </div>
                            <div class="page-head-bgimg clearfix">
                                <form  action="" id="bgfileForm" method="post"  enctype="multipart/form-data"  runat="server" >
                                    <div><label class="tit">中间背景图：</label></div>
                                    <div class="bgimg"><input name="fileimg" type="hidden" value="{if $content.img_file}{$content.img_file}{else}images/bgimg.gif{/if}"/><img id="confilefile" src="{if $content.img_file}{$content.img_file}{else}images/bgimg.gif{/if}" alt=""></div>
                                    <div class="action">
                                        <div class="action-btn">
                                            <a href="javascript:void(0);" class="ks-uploader-button">
                                                <span class="btn-text">更换图片</span>
                                                <div class="file-input-wrapper"><input type="file" name="confile" value="更换图片" class="file-input"></div>
                                            </a>
                                            <a href="javascript:void(0);" class="delete">删除</a>
                                        </div>
                                        <div class="content">
                                            <div>文件格式：GIF,JPG,PNG</div>
                                            <div>文件大小：200k以内</div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="bg-show clearfix" {if $content.img_file == ''}style="display:none;"{/if}>
                                <div>背景显示：</div>
                                <div class="bg-show-nr">
                                    <a href="javascript:void(0);" {if $content.bgrepeat eq 'repeat'}class="current"{/if} data-bg-show="repeat">平铺</a>
                                    <a href="javascript:void(0);" {if $content.bgrepeat eq 'repeat-y'}class="current"{/if} data-bg-show="repeat-y">纵向平铺</a>
                                    <a href="javascript:void(0);" {if $content.bgrepeat eq 'repeat-x'}class="current"{/if} data-bg-show="repeat-x">横向平铺</a>
                                    <a href="javascript:void(0);" {if $content.bgrepeat eq 'no-repeat'}class="current"{/if} data-bg-show="no-repeat">不平铺</a>
                                </div>
                            </div>
                            <div class="bg-align clearfix" {if $content.img_file == ''}style="display:none;"{/if}>
                                <div>背景对齐：</div>
                                <div class="bg-align-nr">
                                    <a href="javascript:void(0);" {if $head.align eq 'left'}class="current"{/if} data-bg-align="left">左对齐</a>
                                    <a href="javascript:void(0);" {if $head.align eq 'center'}class="current"{/if} data-bg-align="center">居中</a>
                                    <a href="javascript:void(0);" {if $head.align eq 'right'}class="current"{/if} data-bg-align="right">右对齐</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
        <div class="db_main">
            <div class="design-nav-wrap">
                <div class="btns">
                    <a href="visual_editing.php?act=templates" class="btn btn2">选择模板</a>
                    <a href="javascript:void(0);" class="btn" ectype="preview" >预览</a>
                    <a href="index.php" class="btn" target="_blank" >店铺后台</a>
                    <a href="javascript:void(0);" class="btn btn_blue" data-toggle="modal" ectype="downloadModal">确认发布</a>
                </div>
            </div>
            <div class="pc-page{if $pc_page.tem} {$pc_page.tem}{/if}">
                {if $pc_page.out}
                    {$pc_page.out}
                {else}
                    {include file ='library/pc_page.lbi'}
                {/if}
            </div>
        </div>
    </div>
    
    <input type="hidden" name="suffix" value="{$pc_page.tem}"/>
    <div id="preview-layout"></div>
    <div id="head-layout"></div>
	{insert_scripts files="plupload.full.min.js,spectrum-master/spectrum.js,jquery.purebox.js,../js/jquery.form.js"}
	<script type="text/javascript">
        var ru_id = "{$ru_id}";
        $(document).on("click", "a[ectype='model_edit']", function () {
            var _this = $(this),
				lyrow = _this.parents('.lyrow'),
				
				mode = lyrow.data("mode"),
				img = lyrow.find('*[data-type="range"] img'),
				purebox = lyrow.data("purebox"),
				diff = lyrow.data("diff");

            if (purebox == "adv") {
                var pic_number = lyrow.data('length');
				var spec_attr = lyrow.find('.spec').data('spec');
                spec_attr = JSON.stringify(spec_attr);
                Ajax.call('dialog.php', "act=shop_banner&spec_attr=" + spec_attr  + "&pic_number=" + pic_number + "&mode=" + mode + "&diff=" + diff, query_banner, 'POST', 'JSON');
            } else if (purebox == "goods") {
                var spec_attr = lyrow.find('.spec').data('spec');
                spec_attr = JSON.stringify(spec_attr);
                Ajax.call('dialog.php', "act=goods_info" + "&mode=" + mode + "&diff=" + diff + "&spec_attr=" + encodeURIComponent(spec_attr) , query_goods, 'POST', 'JSON');
            } else if (purebox == "cust") {
                var custom_content = encodeURIComponent(lyrow.find('[data-type="range"]').html());
                Ajax.call('dialog.php', 'act=custom' + '&mode=' + mode + '&custom_content=' + custom_content + "&diff=" + diff, customResponse, 'POST', 'JSON');
            } else if (purebox == "header") {
                var spec_attr = lyrow.find('.spec').data('spec');
                spec_attr = JSON.stringify(spec_attr);
                Ajax.call('dialog.php', 'act=header' + '&mode=' + mode + "&spec_attr=" + encodeURIComponent(spec_attr), headerResponse, 'POST', 'JSON');
            } else if (purebox == "nav") {
                var spec_attr = lyrow.find('.spec').data('spec');
                spec_attr = JSON.stringify(spec_attr);
                Ajax.call('dialog.php', 'act=navigator' + '&mode=' + mode + '&spec_attr=' + encodeURIComponent(spec_attr), navigatorResponse, 'POST', 'JSON');
            }
        });
    
        //头部弹窗
        function headerResponse(result) {
            var content = result.content;
            pb({
                id: "header_dialog",
                title: "头部编辑器",
                width: 945,
                content: content,
                ok_title: "确定",
                drag: true,
                foot: true,
                cl_cBtn: false,
                onOk: function () {
                    header_back(result.mode)
                }
            });
        }
    
        function header_back(mode) {
            var obj = $("#header_dialog");
            var header_type =  obj.find("input[name='header_type']:checked").val();
            var headerbg_img = obj.find("input[name='fileimg']").val();
            

            var picHeight = obj.find("input[name='picHeight']").val();
            var custom_content = obj.find("input[name='custom_content']").val();
            var _this = $("*[data-mode=" + mode + "]").find('[data-type="range"]');
            var spec_attr = new Object();
            spec_attr.header_type = header_type;
            spec_attr.headerbg_img = headerbg_img;
            spec_attr.picHeight = picHeight;
            spec_attr.custom_content = custom_content;

            if(header_type == 'defalt_type'){
               _this.html("<div class='spec' data-spec='"+$.toJSON(spec_attr)+"'><img src='"+headerbg_img+"' /></div>");
            }else{
                _this.html("<div class='spec' data-spec='"+$.toJSON(spec_attr)+"'>"+custom_content+"</div>");
            }
            visual();
        }
       
        //导航弹窗
        function navigatorResponse(result) {
            var content = result.content;
            pb({
                id: "navigator_dialog",
                title: "导航编辑器",
                width: 850,
                content: content,
                ok_title: "确定",
                drag: true,
                foot: true,
                cl_cBtn: false,
                onOk: function () {
                    navigator_back(result.mode)
                }
            });
        }
    
        function navigator_back(mode) {
            var spec_attr = new Object();
            var obj = $("#navigator_dialog"),
            nav_name = [],
            link = [],
            store_order = [],
            navColor = '',
            target = '',
            align = '';
           
            obj.find("input[name='nav_name[]']").each(function () {
                var pnav_name = $(this).val();
                nav_name.push(pnav_name);
            });
            obj.find("input[name='link[]']").each(function () {
                var plink = $(this).val();
                link.push(plink);
            });
            obj.find("input[name='store_order[]']").each(function () {
                var pstore_order = $(this).val();
                store_order.push(pstore_order);
            });
            navColor = obj.find(".navColor").val();
            target = obj.find("input[name='target']:checked").val();
            align = obj.find("select[name='align']").val();
            spec_attr.nav_name = nav_name;
            spec_attr.link = link;
            spec_attr.store_order = store_order;
            spec_attr.navColor = navColor;
            spec_attr.target = target;
            spec_attr.align = align;
            
            Ajax.call('get_ajax_content.php', "act=navigator&spec_attr=" + encodeURIComponent($.toJSON(spec_attr))  + "&mode=" + mode, addnavigatorResponse, 'POST', 'JSON');
        }
        function addnavigatorResponse(result){
            $("*[data-mode=" + result.mode + "]").find('[data-type="range"]').html(result.content);
            $("*[data-mode=" + result.mode + "]").find('[data-type="range"]').find(".spec").remove();
            $("*[data-mode=" + result.mode + "]").find('[data-type="range"]').append("<div class='spec' data-spec='"+result.spec_attr+"'></div>");
            $("*[data-mode=" + result.mode + "]").parents(".nav_bg").css({"background-color":result.navColor});
            visual();
        }
       
        //广告弹出窗口
        function query_banner(result) {
            var content = result.content;
            pb({
                id: "banner_dialog",
                title: "图片编辑器",
                width: 870,
                content: content,
                ok_title: "确定",
                drag: true,
                foot: true,
                cl_cBtn: false,
                onOk: function () {
                    addshop_banner("#banner_dialog",result.mode,result.diff);
                }
            });
        }
        function addshop_banner(obj,mode,diff) {
            var spec_attr = new Object();
            var obj = $(obj);
            var pic_src = [];
            var link = [];
            var sort = [];
            var bg_color = [];
			
			var picHeight = obj.find("input[name='picHeight']");
			var slideType = obj.find("input[name='slide_type']");
			var itemsLayout = obj.find("input[name='itemsLayout']");
			var target = obj.find("input[name='target']");
			
            if (picHeight.val()){
                spec_attr.picHeight = picHeight.val();
            }
            if (slideType.length > 0){
                spec_attr.slide_type =  obj.find("input[name='slide_type']:checked").val();
            }
            if (itemsLayout.val()){
                spec_attr.itemsLayout = itemsLayout.val();
            }
            if (target.val()) {
                spec_attr.target = obj.find("input[name='target']:checked").val();
            }
			
            //图片路径
            obj.find("input[name='pic_src[]']").each(function () {
                var psrc = $(this).val();
                pic_src.push(psrc);
            });
            //图片链接
            obj.find("input[name='link[]']").each(function () {
                var plink = $(this).val();
                link.push(plink);
            });
            //排序
            obj.find("input[name='sort[]']").each(function () {
                var psort = $(this).val();
                sort.push(psort);
            });
            //排序
            obj.find("input[name='bg_color[]']").each(function () {
                var pbg_color = $(this).val();
                bg_color.push(pbg_color);
            });
            if($("*[data-mode=" + mode + "]").data('li')){
                spec_attr.is_li = $("*[data-mode=" + mode + "]").data('li');
            }else{
                spec_attr.is_li = 0;
            }
            spec_attr.bg_color = bg_color;
            spec_attr.pic_src = pic_src;
            spec_attr.link = encodeURIComponent(link);
            spec_attr.sort = sort;
            
            Ajax.call('get_ajax_content.php', "act=addmodule&diff=" + diff  + "&mode=" + mode + "&spec_attr=" +  $.toJSON(spec_attr), addmoduleResponse, 'POST', 'JSON');
        }
    
        function addmoduleResponse(data) {
			var obj = $(".demo *[data-mode=" + data.mode + "][data-diff="+data.diff+"]");
			if(data.mode == "advImg4"){
				obj.find('[data-type="range"]').removeClass().addClass(data.itemsLayout);
			}else if(data.mode == "lunbo"){
				obj.find('.shop_banner').removeClass("shade").removeClass("roll").addClass(data.slide_type);
			}else if(data.mode == "advImg1"){				
				obj.find('.adv_module').removeClass("yesSlide").removeClass("noSlide").addClass(data.slide_type);
			}else if(data.mode == "advImg3"){
				obj.find('[data-type="range"]').removeClass().addClass(data.itemsLayout);
			}else if(data.mode == "advImg2"){
				obj.find('[data-type="range"]').removeClass().addClass("advImgtwo");
			}
            obj.find('[data-type="range"]').html(data.content);
            obj.find(".spec").remove();
            obj.find('[data-type="range"]').after("<div class='spec' data-spec='"+data.spec_attr+"'>");
            sider();
            visual();
        }
        //广告弹出窗口end
    
        //商品弹出窗口
        function query_goods(result) {
            var content = result.content;
            pb({
                id: "goods_dialog",
                title: "商品编辑器",
                width: 950,
                content: content,
                ok_title: "确定",
                drag: true,
                foot: true,
                cl_cBtn: false,
                onOk: function () {
                    replace_goods(result.mode,result.diff)
                }
            });
        }
    
        function replace_goods(mode,diff) {
            var spec_attr = new Object();
            spec_attr.cat_desc = $('input[name="cat_desc"]').val();
            spec_attr.goods_ids = $('input[name="goods_ids"]').val();
            spec_attr.cat_name = $('input[name="cat_name"]').val();
            spec_attr.align = $('select[name="align"]').val();
            spec_attr.is_title = $("input[name='is_title']:checked").val();
            spec_attr.itemsLayout = $("input[name='itemsLayout']").val();
            Ajax.call('get_ajax_content.php?is_ajax=1&act=changedgoods', "temp=replace&spec_attr=" + $.toJSON(spec_attr) + "&diff=" + diff + "&mode=" + mode, replaceResponse, 'POST', 'JSON');
        }
    
        function replaceResponse(data) {
			var obj = $("*[data-mode=" + data.mode + "][data-diff="+data.diff+"]");
            
			//设置商品楼层是否显示标题
			if(data.is_title == 1){
				obj.find(".mt").remove();
				obj.find(".mc").before("<div class='mt'><div class='con'><h2>" + data.cat_name + "</h2><p>" + data.cat_desc + "</p></div></div>");
			}else{
				obj.find(".mt").remove();
			}
			
            //替换楼层内容
            obj.find('[data-type="range"] ul').removeClass().addClass(data.itemsLayout);	
			obj.find('[data-type="range"] ul').html(data.content);
			obj.find('input[name="goods_info"]').val(data.goods_ids);
            obj.find('.mc').find(".spec").remove();
			obj.find('.mc').append("<div class='spec' data-spec='"+data.spec_attr+"'></div>");

            visual();
        }
        //商品弹出窗口end
    
        //自定义弹窗
        function customResponse(result) {
            var content = result.content;
            pb({
                id: "custom_dialog",
                title: "自定义编辑器",
                width: 850,
                content: content,
                ok_title: "确定",
                drag: true,
                foot: true,
                cl_cBtn: false,
                onOk: function () {
                    custom_back(result.mode,result.diff)
                }
            });
        }
    
        function custom_back(mode,diff) {
            var custom_content = $("input[name='custom_content']").val();
            $("*[data-mode=" + mode + "][data-diff="+diff+"]").find('[data-type="range"]').html(custom_content);
            visual();
        }
        //自定义弹窗end
    
        //页面加载
        $(window).ready(function (e) {
            var height = $(window).height();
            var width = $(window).width();
            $(".page-head-bg-content-wrap").css({"height": height-30});
            $(".demo").css({"min-height":height});
            $(".pc-page").css({"height": height-61});
            
            $(".main-wrapper").addClass("wpst-toolbar-show");
            $(".tab-bar").find("li").eq(0).addClass("current");
            $(".toolbar").find("li").eq(0).addClass("current");
            
            if($(".main-wrapper").hasClass("wpst-toolbar-show")){
                $(".pc-page").css({"width":width-310});
            }else{
                $(".pc-page").css({"width":width-80});
            }
            
            //左侧侧边栏
            db_leftcolumn = function () {
                var li = $(".tab-bar").find("li"),
                    ul = li.parent(".tab-bar"),
                    wrapper = li.parents(".main-wrapper"),
                    toolbar = ul.siblings(".toolbar");
        
                li.on("click", function () {
                    var index = $(this).index();
        
                    if ($(this).hasClass("current")) {
                        $(this).removeClass("current");
                        wrapper.removeClass("wpst-toolbar-show");
                        $(".pc-page").css({"width":width-80});
                    }else{
                        $(this).addClass("current").siblings().removeClass("current");
                        toolbar.find(".li").eq(index).addClass("current").siblings().removeClass("current");
                        wrapper.addClass("wpst-toolbar-show");
                        $(".pc-page").css({"width":width-310});
                    }
                });
            }
            db_leftcolumn();
        
            //右侧点击
            $(document).on("click", ".tab li", function () {
                var index = $(this).index();
                $(this).addClass("current").siblings().removeClass("current");
                $(".modal-body").find(".body_info").eq(index).show().siblings().hide();
            });
        
            $(document).on("click", ".itemsLayout", function () {
                $(this).find(".itemsLayoutShot").addClass("dtselected");
                $(this).siblings().find(".itemsLayoutShot").removeClass("dtselected");
                $("input[name='itemsLayout']").val($(this).data("line"));
            });
        
            //关闭右侧导航
            $(document).on("click", ".close-icon", function () {
                $(this).parents(".li").removeClass("current");
                $(this).parents(".main-wrapper").removeClass("wpst-toolbar-show");
                $(this).parents(".main-wrapper").find(".tab-bar li").removeClass("current");
                $(".pc-page").css({"width":width-80});
            });
        });
    
        $(window).resize(function (e) {
            var height = $(window).height();
            var width = $(window).width();
            $(".page-head-bg-content-wrap").css({"height": height - 30});
            $(".demo").css("min-height", height);
            $(".pc-page").css("height", height - 61);
            
            if($(".main-wrapper").hasClass("wpst-toolbar-show")){
                $(".pc-page").css({"width":width-310});
            }else{
                $(".pc-page").css({"width":width-80});
            }
        });
    
        //商品名称颜色设置
        $(".page-head-bg .tm-picker-trigger").spectrum({
            showInitial: true,
            showPalette: true,
            showSelectionPalette: true,
            showInput: true,
            color: "#fff",
            showSelectionPalette: true,
            maxPaletteSize: 10,
            preferredFormat: "hex",
            palette: [
                ["rgb(0, 0, 0)", "rgb(67, 67, 67)", "rgb(102, 102, 102)",
                "rgb(204, 204, 204)", "rgb(217, 217, 217)","rgb(255, 255, 255)"],
                ["rgb(152, 0, 0)", "rgb(255, 0, 0)", "rgb(255, 153, 0)", "rgb(255, 255, 0)", "rgb(0, 255, 0)",
                "rgb(0, 255, 255)", "rgb(74, 134, 232)", "rgb(0, 0, 255)", "rgb(153, 0, 255)", "rgb(255, 0, 255)"], 
                ["rgb(230, 184, 175)", "rgb(244, 204, 204)", "rgb(252, 229, 205)", "rgb(255, 242, 204)", "rgb(217, 234, 211)", 
                "rgb(208, 224, 227)", "rgb(201, 218, 248)", "rgb(207, 226, 243)", "rgb(217, 210, 233)", "rgb(234, 209, 220)", 
                "rgb(221, 126, 107)", "rgb(234, 153, 153)", "rgb(249, 203, 156)", "rgb(255, 229, 153)", "rgb(182, 215, 168)", 
                "rgb(162, 196, 201)", "rgb(164, 194, 244)", "rgb(159, 197, 232)", "rgb(180, 167, 214)", "rgb(213, 166, 189)", 
                "rgb(204, 65, 37)", "rgb(224, 102, 102)", "rgb(246, 178, 107)", "rgb(255, 217, 102)", "rgb(147, 196, 125)", 
                "rgb(118, 165, 175)", "rgb(109, 158, 235)", "rgb(111, 168, 220)", "rgb(142, 124, 195)", "rgb(194, 123, 160)",
                "rgb(166, 28, 0)", "rgb(204, 0, 0)", "rgb(230, 145, 56)", "rgb(241, 194, 50)", "rgb(106, 168, 79)",
                "rgb(69, 129, 142)", "rgb(60, 120, 216)", "rgb(61, 133, 198)", "rgb(103, 78, 167)", "rgb(166, 77, 121)",
                "rgb(91, 15, 0)", "rgb(102, 0, 0)", "rgb(120, 63, 4)", "rgb(127, 96, 0)", "rgb(39, 78, 19)", 
                "rgb(12, 52, 61)", "rgb(28, 69, 135)", "rgb(7, 55, 99)", "rgb(32, 18, 77)", "rgb(76, 17, 48)"]
            ]
        });
		
        //右侧导航 头部添加背景颜色
        $("input[name='header_dis']").click(function(){
			var style = $(this).parents(".li").data("style");
            var bgDiv = $(this).parents(".page-head-bg");
            var bgColor = bgDiv.find(".tm-picker-trigger").val();
    
            if($(this).prop("checked") == true){
                $(".pc-page").find(".hd_bg").css({"background-color":bgColor});
            }else{
                $(".pc-page").find(".hd_bg").css({"background-color":"transparent"});
            }
			generate(style);
        });
		
        //右侧导航 头部添加背景图
		var suffix = $("input[name='suffix']").val();
        $.upload_file("input[name='hdfile']","visual_editing.php?act=header_bg&type=headerbg&name=hdfile&suffix="+suffix,"#showbgfile",function fn(obj,img){
            var parent = obj.parents(".page-head-bgimg");
            var repeat = parent.siblings(".bg-show").find(".current").data("bg-show");
            var position = parent.siblings(".bg-align").find(".current").data("bg-align");
            parent.siblings(".bg-show,.bg-align").show();
            $(".pc-page").find(".hd_bg").css({"background-image":"url("+img+")","background-repeat":repeat,"background-position":position});
        });
        
        //右侧导航 中间添加背景图
        $("input[name='content_dis']").click(function(){
			var style = $(this).parents(".li").data("style");
            var bgDiv = $(this).parents(".page-head-bg");
            var bgColor = bgDiv.find(".tm-picker-trigger").val();
    
            if($(this).prop("checked") == true){
                $(".demo").css({"background-color":bgColor});
            }else{
                $(".demo").css({"background-color":"transparent"});
            }
			generate(style);
        });
        
        //右侧导航 中间添加背景图
        $.upload_file("input[name='confile']","visual_editing.php?act=header_bg&type=contentbg&name=confile&suffix="+suffix,"#confilefile",function fn(obj,img){
            var parent = obj.parents(".page-head-bgimg");
            var repeat = parent.siblings(".bg-show").find(".current").data("bg-show");
            var position = parent.siblings(".bg-align").find(".current").data("bg-align");
            parent.siblings(".bg-show,.bg-align").show();
            
            $(".demo").css({"background-image":"url("+img+")","background-repeat":repeat,"background-position":position});
        });
        
        //右侧导航 删除头部或者中间背景图
        $(document).on("click",".action-btn .delete",function(){
            var suffix = $("input[name='suffix']").val();
            var form =$(this).parents("form"); 
            var fileimg = form.find("input[name='fileimg']").val();
            form.find("input[name='fileimg']").val("");

            form.find(".bgimg img").attr("src","images/bgimg.gif");
            form.parent(".page-head-bgimg").siblings(".bg-show,.bg-align").hide();
            
            $(".pc-page").find(".hd_bg").css({"background-image":"none"});
            $(".demo").css({"background-image":"none"});
            var type = form.parents('li').data("style");
            Ajax.call('visual_editing.php', "act=remove_img&fileimg=" + fileimg + "&suffix="+suffix + "&type=" + type, '', 'POST', 'JSON');
        });
        
        //右侧导航 头部/中间 背景平铺
        $(document).on("click", ".bg-show-nr a", function () {
            var style = $(this).parents(".li").data("style");
            var repeat = $(this).data("bg-show");
			
            $(this).addClass("current").siblings().removeClass("current");
            
            if(style == "head"){
                $(".pc-page").find(".hd_bg").css({"background-repeat":repeat});
            }else{
                $(".demo").css({"background-repeat":repeat});
            }
			generate(style);
        });
        $(document).on("click", ".bg-align-nr a", function () {
            var style = $(this).parents(".li").data("style");
            var position = $(this).data("bg-align");
            $(this).addClass("current").siblings().removeClass("current");
            if(style == "head"){
                $(".pc-page").find(".hd_bg").css({"background-position":position});
            }else{
                $(".demo").css({"background-position":position});
            }
			generate(style);
        });
        
        //店铺自定义导航编辑
        $(document).on("change","#catagory_type",function(){
            var val = $(this).val();
            var fald = false;
            if(val == 1){
                $(this).siblings("#sys_catagory").hide();
                $(this).siblings("input[name='custom_catagory']").show();
                fald = true;
            }else if(val == 2){
                $(this).siblings("input[name='custom_catagory']").hide();
                $(this).siblings("#sys_catagory").show();
                fald = true;
            }else{
                $(this).siblings("input[name='custom_catagory']").hide();
                $(this).siblings("#sys_catagory").hide();
                fald = false;
            }
            
            if(fald == true){
                $(this).siblings(".btn").removeClass("btn_disabled");
            }else{
                $(this).siblings(".btn").addClass("btn_disabled");
            }
        });
        
        $(document).on("click",".addCatagory .btn",function(){
            var tbody = $(this).parents(".body_info").find("tbody");
            
            if(!$(this).hasClass("btn_disabled")){
                var catagory_type = $("#catagory_type").val();
                var link ='';
                var nav_name = '';
                
                if(tbody.find(".notic").length>0){
                    tbody.find(".notic").remove();
                }
                if(catagory_type == '1'){
                    nav_name = $("input[name='custom_catagory']").val();
                }else if(catagory_type == '2'){
                    var cat = $("#sys_catagory").val();
                    cat = cat.split("|");
                    nav_name = cat[2];
                    link = cat[3];
                }
                tbody.append("<tr><td><input type='text' name='nav_name[]' value='"+nav_name+"'></td><td><input type='text' name='link[]' value='"+link+"'></td><td class='center'><input type='text' class='small' name='store_order[]' value='1'></td><td class='center'><a href='javascript:void(0);' class='pic_del del'>删除</a></td></tr>")
            }else{
                alert("请选择添加分类类型");
            }
        });
        
        $(document).on("click",".pic_del",function(){
            var tbody = $(this).parents("tbody");
            var table = tbody.parent("table").data("table");
            
            $(this).parents("tr").remove();
            
            if(tbody.find("tr").length < 1){
                if(table == "navtable"){
                    tbody.append("<tr class='notic'><td colspan='4'>当前没有自定义商品分类，点击下面添加新分类添加</td></tr>")
                }else{
                    tbody.append("<tr class='notic'><td colspan='5'>点击下列图片空间图片可添加图片或点击上传图片按钮上传新图片</td></tr>")
                }
            }
        });
        
        function sider(){
            $(".shop_banner,.adv_module").slide({titCell:".hd ul",mainCell:".bd ul",trigger:"click",delayTime:0});
        }
            
		/*预览*/
		$(document).on("click", "a[ectype='preview']", function () {
			window.open('../merchants_store.php?merchant_id='+ru_id);

		});
            
        /*生成缓存文件*/
        function visual(){
            var suffix = $("input[name='suffix']").val();
            var content = $('.pc-page').html();
            var content_html = "";
            //全部内容页html
            var preview = $("#preview-layout");
            
                preview.html("");
                
                preview.append(content);
                
                preview.find("*[data-html='not']").remove();
                preview.find(".lyrow").removeClass("lyrow");
                preview.find(".ui-draggable").removeClass("ui-draggable");
                preview.find(".ui-box-display").removeClass("ui-box-display");
                preview.find(".lunbotu").removeClass("lunbotu");
                preview.find(".demo").removeClass().addClass("content");
                
                content_html = preview.html();

                //头部html
                var head_content = $('.hd_main').html()
                var headlayout = $("#head-layout");
                var head_html = '';
                headlayout.html("");
                
                headlayout.append(head_content);
                
                headlayout.find("*[data-html='not']").remove();
                headlayout.find(".lyrow").removeClass("lyrow");
                headlayout.find(".ui-draggable").removeClass("ui-draggable");
                headlayout.find(".ui-box-display").removeClass("ui-box-display");
                headlayout.find(".lunbotu").removeClass("lunbotu");
                headlayout.find(".demo").removeClass().addClass("content");
                
                head_html = headlayout.html();

                Ajax.call('visual_editing.php', "act=file_put_visual&content=" + encodeURIComponent(content)+"&content_html="+encodeURIComponent(content_html)+"&head_html="+encodeURIComponent(head_html)+"&suffix="+suffix, file_put_visualResponse, 'POST', 'JSON');
        }
        function file_put_visualResponse(result){
            if(result.error == 0){
                $("input[name='suffix']").val(result.suffix);
            }else{
                alert("改模板不存在，请重试");
            }
        }
        
        /*发布*/
        $(document).on("click", "a[ectype='downloadModal']", function () {
            var suffix = $("input[name='suffix']").val();
                Ajax.call('visual_editing.php', "act=release&suffix=" + suffix, downloadModalResponse, 'POST', 'JSON');
        })
        function downloadModalResponse(data){
            if(data.error == 1){
                location.href = 'visual_editing.php?act=first';
            }else{
                alert(data.content);
            }
        }
		
        /*更新左侧缓存文件*/
        function generate(type){
                        var suffix = $("input[name='suffix']").val();
			var bgDiv = $("[data-style="+type+"]");
			var checkbox = bgDiv.find(".ui-checkbox");
			var bgColor = "",bgshow = "",bgalign = "";
			var bgimg = bgDiv.find("input[name='fileimg']");
			var is_show = 0;
			if(checkbox.prop("checked") == true){
				bgColor = bgDiv.find(".tm-picker-trigger").val();
                                bgshow = 1;
			}
			
			if(bgimg != ""){
				bgshow = bgDiv.find(".bg-show-nr a.current").data("bg-show");
				bgalign = bgDiv.find(".bg-align-nr a.current").data("bg-align");
			}
            Ajax.call('visual_editing.php', "act=generate&suffix=" + suffix + "&bg_color=" +bgColor + "&is_show=" +is_show + "&type=" + type + "&bgshow=" + bgshow + "&bgalign=" + bgalign, generateResponse, 'POST', 'JSON');
        }
        function generateResponse(data){
            if(data.error == 1){
                visual();
            }else{
                alert(data.content);
            }
        }
    </script>
</body>
</html>