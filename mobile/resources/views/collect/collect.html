{include file="page_header-nav"}
<link rel="stylesheet" href="../mobile/statics/css/partner.css">
<script src="../mobile/statics/js/jquery-2.1.4.min.js"></script>
<body>
	<img src="{$img}" alt="">
	<button id="show" type="button" value="{$user_id}">
		点赞助力	
	</button>
	<button id="colect" type="button" value="{$user_id}">
		我要参与	
	</button>
	<!-- <div id="output" style="display: none;">
		<img src="../mobile/statics/img/newapp/zsjm.png" alt="aaa">
	</div> -->
<div class="dialog-getTel dialog flex">
    <div class="content"style="margin-top: 200px;">
        <form class="flex" action="">
            <input id="tel" type="number" pattern="[0-9]*" placeholder="请输入您的手机号" />
            <div class="getCode flex" >
                <input id="code" type="number" pattern="[0-9]*" placeholder="您的验证码">
                <button type="button">获取验证码</button>
            </div>
            <div class="flex fora">
            	<div class="kong"></div>
            	 <a class="finish">完成</a>
            	 <div class="kong"></div>
            	 <a class="cansle">取消</a>
            	 <div class="kong"></div>
            </div>
        </form>
    </div>
</div>
	<script>
		$(function(){
			$("#show").click(function(){
				var user_id=$(this).attr("value");
				
				//如果用户未登录   进入登录过程 
				if(user_id <= 0){
					$(".flex").show();
					//当用户是新用户   可参加活动   if  注册时间<活动开始时间 给Tips  
				}else{
					//如果用户已经登录 会有两个按钮 一个是我要助力  另一个是我要参加
				}
			 	// $("#output").css('display',"block");
			})
		})
		// 验证手机号码
	    var check_phone = function (phone) {
	        if(!(/^1[3|4|5|7|8][0-9]\d{4,8}$/.test(phone))) {
	            $("#tel+span").remove();
	            $("#tel").after("<span class='error'>您的号码有误</span>");
	            return false;
	        }else if(phone != null){
	            var param = {phone:phone};
	            var url = '../mobile/index.php?r=collect/index/checknum';
	            $.post(url,param,function (data) 
	            {
	            	console.log(data);
	                var result = eval('('+data+')');
	                if(result.code == 1)//这个用户是老用户  不可参加活动
	                {
	                    $("#tel+span").remove();
	                    $("#tel").after("<span class='error'>您的号码有误</span>");
	                    return false;
	                }else if (result.code=2) {//新用户
	                	//console.log("可参与活动");
	                	$("#tel+span").remove();
	            		return true;
	                } 
	            })
	        }
	        else {
	            $("#tel+span").remove();
	            return true;
	        };
	    };
		//点击获取验证码
	    $(".getCode button").on("click",function(e) {
	        var tel = $('#tel').val();
	        var check_tel = check_phone(tel),$this = $(this);
	        //console.log(check_tel);
	        if(check_tel){
	            var param = {phone:tel};
	            var url = '../mobile/index.php?r=active/index/send';
	            $.post(url,param,function (data) {
	                var result = eval('('+data+')');
	                if(result.code == 10){
	                    var time = 60,
	                        timer,
	                        action = function() {
	                            time--;
	                            if(time > 0) {
	                                $this.text(time + "秒后重新获取");
	                            }else {
	                                $this.text("获取验证码").prop("disabled",false);
	                                clearInterval(timer);
	                            }
	                        };
	                    $this.prop("disabled",true);
	                    timer = setInterval(action,1000);
	                }else {
	                    $(".getCode+span").remove();
	                    $(".getCode").after("<span class='error'>"+result.info+"</span>");
	                }
	            });
	        }
	    });
	    // 完成验证码登录
    $(".dialog-getTel .finish").on("click",function() {
    	var tel = $("#tel").val(),
    		code = $("#code").val(),
    		$dialog = $(".dialog-getTel");
    		if(code == "") {
    			$(".getCode+span").remove();
    			$(".getCode").after("<span class='error'>您的验证码有误</span>");
    			// $(".dialog-getTel a").css("margin-top",".5rem");
    		}else {
    			$(".getCode+span").remove();
    			// $(".dialog-getTel a").css("margin-top","2rem");
    			var param = {phone:tel,code:code};
    			var url = '../mobile/index.php?r=active/index/check';
    			$.post(url,param,function (data) {
                    var result = eval('('+data+')');
                    if(result.code == 13){
                        init_prize();
                        $dialog.hide();
                        qian();
                        if(istrueimg) $(".tqian").show();
                    }else {
                        $(".getCode+span").remove();
                        $(".getCode").after("<span class='error'>"+result.info+"</span>");
                        return false;
                    }
                });
    		};
    });
    $(".dialog-Winning a").on("click",function() {
        var $dialog = $(".dialog-Winning");
        $dialog.hide();
    });
	</script>
</body>
</html>